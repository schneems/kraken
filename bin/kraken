#!/usr/bin/env ruby

require 'bundler/setup'
require 'require_all'
require 'kraken'

if ARGV.include? '-n'
  require 'fileutils'
  FileUtils.mkdir_p "#{ARGV.last}/config" unless File.exist? "#{ARGV.last}/config"
  FileUtils.mkdir_p "#{ARGV.last}/app/models" unless File.exist? "#{ARGV.last}/app/models"
  FileUtils.mkdir_p "#{ARGV.last}/app/triggers" unless File.exist? "#{ARGV.last}/app/triggers"
  echo "\"#{Kraken::MIGRATION_DEFAULT}\" >> #{ARGV.last}/migration.rb"
  exit
end

if ARGV.include? '-v'
  puts 'KrakenLab'
  puts "-v #{Kraken::VERSION}"
  exit
end

require_all 'app'
require_all 'config'

DataMapper.finalize

if ARGV.include? '-m'
  require  'dm-migrations'
  DataMapper.auto_migrate!
  exit
end

if ARGV.include? '-d'
  require 'irb'
  IRB.start(__FILE__)
  exit
end

Kraken::Listener.new.join if ARGV.include? '-s'
