#!/usr/bin/env ruby

require 'bundler/setup'
require 'require_all'
require 'kraken'

if ARGV.include? '-n'
  require 'fileutils'
  FileUtils.mkdir_p "#{ARGV.last}/config" unless File.exist? "#{ARGV.last}/config"
  FileUtils.mkdir_p "#{ARGV.last}/app/models" unless File.exist? "#{ARGV.last}/app/models"
  FileUtils.mkdir_p "#{ARGV.last}/app/triggers" unless File.exist? "#{ARGV.last}/app/triggers"
  require 'kraken/migration'
  require 'kraken/rakefile'
  system "echo \"#{Kraken::MIGRATION_DEFAULT}\" >> #{ARGV.last}/migration.rb"
  system "echo \"#{Kraken::RAKEFILE_DEFAULT}\" >> Rakefile"
  exit
end

if ARGV.include? '-v'
  puts 'KrakenLab'
  puts "-v #{Kraken::VERSION}"
  exit
end

Kraken.load_app

if ARGV.include? '-m'
  require './migration.rb'
  exit
end

if ARGV.include? '-d'
  require 'irb'
  IRB.start(__FILE__)
  exit
end

Kraken::Listener.new.join if ARGV.include? '-s'
